<app-header></app-header>

<main class="product-list-page">
  <div class="container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
      <a routerLink="/" class="breadcrumb-item">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2"/>
        </svg>
        Accueil
      </a>
      <svg class="breadcrumb-separator" viewBox="0 0 24 24">
        <polyline points="9 18 15 12 9 6" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span class="breadcrumb-item active">Produits</span>
    </nav>

    <!-- Header -->
    <div class="page-header">
      <div>
        <h1>üõçÔ∏è Nos Produits</h1>
        <p class="results-count">
          <strong>{{ totalElements() }}</strong> produits disponibles
          @if (activeFiltersCount() > 0) {
            <span class="filters-badge">{{ activeFiltersCount() }} filtre(s) actif(s)</span>
          }
        </p>
      </div>
      
      <div class="header-actions">
        <button class="btn btn-secondary mobile-only" (click)="toggleFilters()">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z" stroke="currentColor" stroke-width="2"/>
          </svg>
          Filtres
          @if (activeFiltersCount() > 0) {
            <span class="badge">{{ activeFiltersCount() }}</span>
          }
        </button>
        
        @if (activeFiltersCount() > 0) {
          <button class="btn btn-ghost" (click)="clearFilters()">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2"/>
            </svg>
            R√©initialiser
          </button>
        }
      </div>
    </div>

    <div class="content-wrapper">
      <!-- Sidebar Filtres -->
      <aside class="filters-sidebar" [class.show]="showFilters()">
        <div class="filters-header">
          <h2>üéØ Filtres</h2>
          <button class="close-btn mobile-only" (click)="toggleFilters()">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="filters-content">
          <!-- Prix -->
          <div class="filter-section">
            <button class="filter-header" (click)="togglePriceFilter()">
              <h3 class="filter-title">üí∞ Prix</h3>
              <svg class="chevron" [class.open]="showPriceFilter()" viewBox="0 0 24 24" fill="none">
                <polyline points="6 9 12 15 18 9" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
            
            @if (showPriceFilter()) {
              <div class="filter-content">
                <div class="price-inputs">
                  <div class="price-input-group">
                    <label>Min</label>
                    <input 
                      type="number" 
                      [value]="priceRange().min"
                      (input)="onPriceRangeChange($any($event.target).value, priceRange().max)"
                      min="0"
                      max="5000"
                      step="50"
                      class="form-input">
                    <span>‚Ç¨</span>
                  </div>
                  <span class="separator">-</span>
                  <div class="price-input-group">
                    <label>Max</label>
                    <input 
                      type="number" 
                      [value]="priceRange().max"
                      (input)="onPriceRangeChange(priceRange().min, $any($event.target).value)"
                      min="0"
                      max="5000"
                      step="50"
                      class="form-input">
                    <span>‚Ç¨</span>
                  </div>
                </div>
                
                <div class="price-range-slider">
                  <input 
                    type="range" 
                    [value]="priceRange().min"
                    (input)="onPriceRangeChange($any($event.target).value, priceRange().max)"
                    min="0"
                    max="5000"
                    step="50"
                    class="range-input range-min">
                  <input 
                    type="range" 
                    [value]="priceRange().max"
                    (input)="onPriceRangeChange(priceRange().min, $any($event.target).value)"
                    min="0"
                    max="5000"
                    step="50"
                    class="range-input range-max">
                </div>
              </div>
            }
          </div>

          <!-- Cat√©gories -->
          <div class="filter-section">
            <button class="filter-header" (click)="toggleCategoriesFilter()">
              <h3 class="filter-title">üìÇ Cat√©gories</h3>
              <svg class="chevron" [class.open]="showCategoriesFilter()" viewBox="0 0 24 24" fill="none">
                <polyline points="6 9 12 15 18 9" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
            
            @if (showCategoriesFilter()) {
              <div class="filter-content filter-options">
                @for (category of categories(); track category.id) {
                  <label class="checkbox-label">
                    <input 
                      type="checkbox"
                      [checked]="selectedCategories().includes(category.id)"
                      (change)="toggleCategory(category.id)">
                    <span class="checkbox-custom"></span>
                    <span class="checkbox-text">{{ category.name }}</span>
                  </label>
                }
              </div>
            }
          </div>

          <!-- Marques -->
          @if (brands().length > 0) {
            <div class="filter-section">
              <button class="filter-header" (click)="toggleBrandsFilter()">
                <h3 class="filter-title">üè∑Ô∏è Marques</h3>
                <svg class="chevron" [class.open]="showBrandsFilter()" viewBox="0 0 24 24" fill="none">
                  <polyline points="6 9 12 15 18 9" stroke="currentColor" stroke-width="2"/>
                </svg>
              </button>
              
              @if (showBrandsFilter()) {
                <div class="filter-content filter-options">
                  @for (brand of brands(); track brand) {
                    <label class="checkbox-label">
                      <input 
                        type="checkbox"
                        [checked]="selectedBrands().includes(brand)"
                        (change)="toggleBrand(brand)">
                      <span class="checkbox-custom"></span>
                      <span class="checkbox-text">{{ brand }}</span>
                    </label>
                  }
                </div>
              }
            </div>
          }

          <!-- √âtat -->
          @if (conditions().length > 0) {
            <div class="filter-section">
              <button class="filter-header" (click)="toggleConditionsFilter()">
                <h3 class="filter-title">‚≠ê √âtat</h3>
                <svg class="chevron" [class.open]="showConditionsFilter()" viewBox="0 0 24 24" fill="none">
                  <polyline points="6 9 12 15 18 9" stroke="currentColor" stroke-width="2"/>
                </svg>
              </button>
              
              @if (showConditionsFilter()) {
                <div class="filter-content filter-options">
                  @for (condition of conditions(); track condition) {
                    <label class="checkbox-label">
                      <input 
                        type="checkbox"
                        [checked]="selectedConditions().includes(condition)"
                        (change)="toggleCondition(condition)">
                      <span class="checkbox-custom"></span>
                      <span class="checkbox-text">{{ condition }}</span>
                    </label>
                  }
                </div>
              }
            </div>
          }
        </div>

        <div class="filters-footer mobile-only">
          <button class="btn btn-secondary" (click)="clearFilters()">R√©initialiser</button>
          <button class="btn btn-primary" (click)="toggleFilters()">Appliquer</button>
        </div>
      </aside>

      <!-- Products Grid -->
      <div class="products-section">
        <!-- Toolbar -->
        <div class="products-toolbar">
          <div class="toolbar-left">
            <p class="results-info">
              @if (isLoading()) {
                <span>Chargement...</span>
              } @else {
                <span><strong>{{ products().length }}</strong> sur <strong>{{ totalElements() }}</strong> produits</span>
              }
            </p>
          </div>
          
          <div class="toolbar-right">
            <select 
              class="sort-select"
              [value]="sortBy()"
              (change)="onSortChange($any($event.target).value)">
              <option value="">Trier par</option>
              <option value="price,asc">Prix croissant</option>
              <option value="price,desc">Prix d√©croissant</option>
              <option value="createdAt,desc">Nouveaut√©s</option>
              <option value="title,asc">Nom A-Z</option>
              <option value="title,desc">Nom Z-A</option>
            </select>
          </div>
        </div>

        <!-- Products Grid -->
        @if (isLoading()) {
          <div class="loading-state">
            <div class="spinner"></div>
            <p>Chargement des produits...</p>
          </div>
        } @else if (products().length === 0) {
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" width="64" height="64">
              <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
              <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <h3>Aucun produit trouv√©</h3>
            <p>Essayez de modifier vos crit√®res de recherche</p>
            <button class="btn btn-primary" (click)="clearFilters()">R√©initialiser les filtres</button>
          </div>
        } @else {
          <div class="products-grid">
            @for (product of products(); track product.id) {
              <app-product-card [product]="product"></app-product-card>
            }
          </div>

          <!-- Pagination -->
          @if (totalPages() > 1) {
            <div class="pagination">
              <button 
                class="pagination-btn"
                [disabled]="currentPage() === 0"
                (click)="onPageChange(currentPage() - 1)">
                <svg viewBox="0 0 24 24" fill="none">
                  <polyline points="15 18 9 12 15 6" stroke="currentColor" stroke-width="2"/>
                </svg>
                Pr√©c√©dent
              </button>
              
              <div class="pagination-numbers">
                @for (page of [].constructor(totalPages()); track $index) {
                  <button 
                    class="pagination-number"
                    [class.active]="currentPage() === $index"
                    (click)="onPageChange($index)">
                    {{ $index + 1 }}
                  </button>
                }
              </div>
              
              <button 
                class="pagination-btn"
                [disabled]="currentPage() === totalPages() - 1"
                (click)="onPageChange(currentPage() + 1)">
                Suivant
                <svg viewBox="0 0 24 24" fill="none">
                  <polyline points="9 18 15 12 9 6" stroke="currentColor" stroke-width="2"/>
                </svg>
              </button>
            </div>
          }
        }
      </div>
    </div>
  </div>

  <!-- Back to Top -->
  @if (showBackToTop()) {
    <button class="back-to-top" (click)="scrollToTop()">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M12 19V5M5 12l7-7 7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  }
</main>

<app-footer></app-footer>
